<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>cpp on Jan Malčák</title>
    <link>https://malja.github.io/docs/tags/cpp/</link>
    <description>Recent content in cpp on Jan Malčák</description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>Po nocích píše Honza</copyright>
    <lastBuildDate>Sat, 26 Mar 2016 22:50:00 +0200</lastBuildDate><atom:link href="https://malja.github.io/docs/tags/cpp/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Arduino: Programování Attiny85</title>
      <link>https://malja.github.io/docs/arduino-programovani-attiny85/</link>
      <pubDate>Sat, 26 Mar 2016 22:50:00 +0200</pubDate>
      
      <guid>https://malja.github.io/docs/arduino-programovani-attiny85/</guid>
      <description>Teď, možná po roce či dvou, jsem je vyhrabal z krabice. Stále jsem přesně netušil, co s nimi, ale v hlavě se mi pár nápadů rýsovalo.
Z mých posledních pokusů jsem si pamatoval, že standardní USBisp, které jsem si koupil na programování čipů ATmega328 nejde použít. Nejjednodušší náhradou se mi jevilo využít Arduino Uno. Na internetu jsem našel velké množství tutoriálů, navíc jde o celkem jednoduchou záležitost.
Prvně je třeba přidat podporu pro čipy rodiny ATtiny do Arduino IDE.</description>
      <content>&lt;p&gt;Teď, možná po roce či dvou, jsem je vyhrabal z krabice. Stále jsem přesně netušil, co s nimi, ale v hlavě se mi pár nápadů rýsovalo.&lt;/p&gt;
&lt;p&gt;Z mých posledních pokusů jsem si pamatoval, že standardní USBisp, které jsem si koupil na programování čipů ATmega328 nejde použít. Nejjednodušší náhradou se mi jevilo využít Arduino Uno. Na internetu jsem našel velké množství tutoriálů, navíc jde o celkem jednoduchou záležitost.&lt;/p&gt;
&lt;p&gt;Prvně je třeba přidat podporu pro čipy rodiny ATtiny do Arduino IDE. Od posledně se situace radikálně zlepšila a není třeba ručně cokoliv stahovat, rozbalovat a kopírovat na správné místo.&lt;/p&gt;
&lt;p&gt;V Arduino IDE otevřete &lt;strong&gt;Nastavení&lt;/strong&gt; -&amp;gt; &lt;strong&gt;File&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Preferences&lt;/strong&gt; a do kolonky &lt;em&gt;Additional Boards Manager URLs&lt;/em&gt; vložte jednu z následujících adres:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://raw.githubusercontent.com/damellis/attiny/ide-1.6.x-boards-manager/package_damellis_attiny_index.json&#34;&gt;https://raw.githubusercontent.com/damellis/attiny/ide-1.6.x-boards-manager/package_damellis_attiny_index.json&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://drazzy.com/package_drazzy.com_index.json&#34;&gt;http://drazzy.com/package_drazzy.com_index.json&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;První z nich přidává podporu jen pro ATtiny 44/45/84/85. Druhá je mnohem rozsáhlejší. Pro mé potřeby až zbytečně.&lt;/p&gt;

  &lt;figure class=&#34;center&#34; &gt;
    &lt;img src=&#34;AddAttinySupport.gif&#34;  alt=&#34;Přidání podpory pro Attiny&#34;   /&gt;
    
      &lt;figcaption class=&#34;center&#34; &gt;Přidání podpory pro Attiny&lt;/figcaption&gt;
    
  &lt;/figure&gt;


&lt;p&gt;Nyní v &lt;strong&gt;Tools&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Board&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Boards Manager&lt;/strong&gt; vyberte a nainstalujeme ATtiny.&lt;/p&gt;

  &lt;figure class=&#34;center&#34; &gt;
    &lt;img src=&#34;AddAttinySupport2.gif&#34;   /&gt;
    
      &lt;figcaption class=&#34;center&#34; &gt;Výše popsaný postup pro přidání podpory Attiny do Arduino IDE&lt;/figcaption&gt;
    
  &lt;/figure&gt;


&lt;p&gt;Tím jsme naučili Arduino IDE hovořit jazykem ATtiny kmene. Už stačí jen udělat z Arduina programátor. Po připojení Arduina k počítači v IDE stačí vybrat vzorový příklad &lt;strong&gt;ArduinoISP&lt;/strong&gt;
(&lt;strong&gt;File&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Examples&lt;/strong&gt; -&amp;gt; &lt;strong&gt;ArduinoISP&lt;/strong&gt; -&amp;gt; &lt;strong&gt;ArduinoISP&lt;/strong&gt;) a nahrát ho. Tím se z Arduina stal programátor, který propojíme s ATtiny a můžeme začít.&lt;/p&gt;

  &lt;figure class=&#34;center&#34; &gt;
    &lt;img src=&#34;attiny85-pinout-simplified.png&#34;   /&gt;
    
      &lt;figcaption class=&#34;center&#34; &gt;Popis pinů. Počítáno z levé horní strany po řádcích: (1) Reset (8) VCC, (2) A3 (7) Pin D2, (3) Pin A2 (6) Pin D1, (4) GND (5) Pin D0&lt;/figcaption&gt;
    
  &lt;/figure&gt;


&lt;p&gt;Propojení je následující:&lt;/p&gt;

  &lt;figure class=&#34;center&#34; &gt;
    &lt;img src=&#34;http://highlowtech.org/wp-content/uploads/2011/06/Screen-shot-2011-06-06-at-1.46.39-PM.png&#34;   /&gt;
    
      &lt;figcaption class=&#34;center&#34; &gt;Zapojení Arduina UNO a Attiny85 pro programování. Vypůjčeno z http://highlowtech.org/?p=1706&lt;/figcaption&gt;
    
  &lt;/figure&gt;


&lt;ul&gt;
&lt;li&gt;ATtiny pin &lt;strong&gt;2&lt;/strong&gt; do Arduino pinu &lt;strong&gt;13&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ATtiny pin &lt;strong&gt;1&lt;/strong&gt; do Arduino pinu &lt;strong&gt;12&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ATtiny pin &lt;strong&gt;0&lt;/strong&gt; do Arduino pinu &lt;strong&gt;11&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ATtiny pin &lt;strong&gt;Reset&lt;/strong&gt; do Arduino pinu &lt;strong&gt;10&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Teď už jen stačí otevřít Sketch, vybrat čip, který budete programovat a nastavit jako programátor &lt;strong&gt;Arduino as ISP&lt;/strong&gt; a vše nahrát.&lt;/p&gt;
&lt;p&gt;A ještě krátká poznámka na konec. Pokud stejně jako já, budete mít trable s nastavením exsterního oscilátoru, doporučuji před nahráním Sketche vypálit &lt;em&gt;Bootloader&lt;/em&gt; (&lt;strong&gt;Tools&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Burn Bootloader&lt;/strong&gt;)&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>Arduino: Odpojení při nahrávání programu</title>
      <link>https://malja.github.io/docs/arduino-odpojeni-pri-nahravani-programu/</link>
      <pubDate>Sat, 14 Mar 2015 22:49:00 +0200</pubDate>
      
      <guid>https://malja.github.io/docs/arduino-odpojeni-pri-nahravani-programu/</guid>
      <description>Při experimentování s Arduinem jsem narazil na podivný problém. Po několika malých úpravách kódu mi editor při nahrávání programu hlásil
Error opening serial port &#39;/dev/ttyACM1&#39;  To vše doplněné dlouhým výpisem kde se chyba vyskytla.
Jako by to nestačilo, Arduino se poté odpojí. Pro připojení bylo nutné vytáhnout a opět zastrčit napájecí USB kabel. Tím se bohužel problém s odpojováním nevyřešil. Obšírným nahlédnutím do složky /dev jsem zjistil, že soubor ttyACM1 existuje.</description>
      <content>&lt;p&gt;Při experimentování s Arduinem jsem narazil na podivný problém. Po několika malých úpravách kódu mi editor při nahrávání programu hlásil&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Error opening serial port &#39;/dev/ttyACM1&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To vše doplněné dlouhým výpisem kde se chyba vyskytla.&lt;/p&gt;
&lt;p&gt;Jako by to nestačilo, Arduino se poté odpojí. Pro připojení bylo nutné vytáhnout a opět zastrčit napájecí USB kabel. Tím se bohužel problém s odpojováním nevyřešil. Obšírným nahlédnutím do složky &lt;code&gt;/dev&lt;/code&gt; jsem zjistil, že soubor &lt;code&gt;ttyACM1&lt;/code&gt; existuje. Příkaz &lt;code&gt;lsusb&lt;/code&gt; Arduino našel. Problém tedy musel být někde jinde.&lt;/p&gt;
&lt;p&gt;Problém přetrvával i po změně zdrojového kódu či načtení některého z příkladů. Nezbylo mi tak, než použít Google. Dle všeho šlo o přepsání hodnoty:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Serial.begin(9600);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;na&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Serial.begin(14400);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Nová hodnota se uloží do uživatelského nastavení. Z nějakého mě neznámého důvodu zůstane tato hodnota v nastavení &amp;ldquo;zadrblá&amp;rdquo; i po opětovné úpravě zdrojáků. Je tedy nutné smazat soubor s nastavením (u mě &lt;code&gt;~/arduino/preferences.txt&lt;/code&gt; a restartovat editor.&lt;/p&gt;
</content>
    </item>
    
    <item>
      <title>SDL2: Snímek obrazovky</title>
      <link>https://malja.github.io/docs/post/</link>
      <pubDate>Wed, 19 Mar 2014 20:57:00 +0200</pubDate>
      
      <guid>https://malja.github.io/docs/post/</guid>
      <description>SDL s sebou ve druhé verzi přinesl i změnu vykreslování na obrazovku. Místo v RAM uložených SDL_Surface je v SDL2 použita SDL_Texture uložená na video RAM, kde je plně v jurisdikci GPU. Krom citelných změn na rychlost vykreslování se také změnil způsob, jakým lze zachytit snímek obrazovky.
Při použití textur se SDL_Surface okna neaktualizuje, pokud bychom použili dřívější způsob, dostali bychom prázdný snímek. Bohužel standardní funkce SDL_SaveBMP (ani její nedokumentovaná obdoba v rozšíření SDL_image - IMG_SavePNG) nepodporuje uložení SDL_Texture.</description>
      <content>&lt;p&gt;SDL s sebou ve druhé verzi přinesl i změnu vykreslování na obrazovku. Místo v RAM uložených &lt;a href=&#34;https://wiki.libsdl.org/SDL_Surface&#34;&gt;SDL_Surface&lt;/a&gt; je v SDL2 použita &lt;a href=&#34;https://wiki.libsdl.org/SDL_Texture&#34;&gt;SDL_Texture&lt;/a&gt; uložená na video RAM, kde je plně v jurisdikci GPU. Krom citelných změn na rychlost vykreslování se také změnil způsob, jakým lze zachytit snímek obrazovky.&lt;/p&gt;
&lt;p&gt;Při použití textur se &lt;code&gt;SDL_Surface&lt;/code&gt; okna neaktualizuje, pokud bychom použili dřívější způsob, dostali bychom prázdný snímek. Bohužel standardní funkce &lt;a href=&#34;https://wiki.libsdl.org/SDL_SaveBMP&#34;&gt;SDL_SaveBMP&lt;/a&gt; (ani její nedokumentovaná obdoba v rozšíření &lt;code&gt;SDL_image&lt;/code&gt; - &lt;code&gt;IMG_SavePNG&lt;/code&gt;) nepodporuje uložení &lt;code&gt;SDL_Texture&lt;/code&gt;. Je proto nejprve nutná konverze z &lt;code&gt;SDL_Texture&lt;/code&gt; na &lt;code&gt;SDL_Surface&lt;/code&gt;. Teprve pak je možné snímek obrazovky uložit.&lt;/p&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;h1 id=&#34;použité-funkce&#34;&gt;Použité funkce&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.libsdl.org/SDL_RenderGetViewport&#34;&gt;SDL_RenderGetViewport&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.libsdl.org/SDL_CreateRGBSurface&#34;&gt;SDL_CreateRGBSurface&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.libsdl.org/SDL_GetError&#34;&gt;SDL_GetError&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.libsdl.org/SDL_RenderReadPixels&#34;&gt;SDL_RenderReadPixels&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.libsdl.org/SDL_FreeSurface&#34;&gt;SDL_FreeSurface&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    </item>
    
    <item>
      <title>C&#43;&#43;: Existuje soubor?</title>
      <link>https://malja.github.io/docs/cpp-existuje-soubor/</link>
      <pubDate>Thu, 04 Jul 2013 14:20:00 +0200</pubDate>
      
      <guid>https://malja.github.io/docs/cpp-existuje-soubor/</guid>
      <description>Pokud bych chtěl jsen přečíst data, jde o problém celkem triviální. Stačí se pokusit tento soubor otevřít. Cest je opět několik:
Takový postup bude ve většině případů plně dostačující. Pro úplnost uvedu ještě příklad s využitím funkce access
Co ale dělat v případě, že chceme o souboru zjistit více informací? Je soubor spustitelný? Jaká je jeho velikost? Jaké je ID vlastníka? V takovém případě se můžeme opřít o funkci stat</description>
      <content>&lt;p&gt;Pokud bych chtěl jsen přečíst data, jde o problém celkem triviální. Stačí se pokusit tento soubor otevřít. Cest je opět několik:&lt;/p&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;p&gt;Takový postup bude ve většině případů plně dostačující. Pro úplnost uvedu ještě příklad s využitím funkce &lt;code&gt;access&lt;/code&gt;&lt;/p&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;p&gt;Co ale dělat v případě, že chceme o souboru zjistit více informací? Je soubor spustitelný? Jaká je jeho velikost? Jaké je ID vlastníka? V takovém případě se můžeme opřít o funkci &lt;code&gt;stat&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// Funkce bere jako parametr jméno souboru a ukazatel na strukturu do které má doplnit data
int stat(const char *filename, struct stat *buf);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Obsah struktury jde vyčíst třeba na &lt;a href=&#34;http://en.wikipedia.org/wiki/Stat_(system_call)&#34;&gt;Wiki&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;st_dev&lt;/strong&gt; - ID zařízení, na kterém je soubor uložen&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;st_ino&lt;/strong&gt; - Číslo &lt;a href=&#34;http://cs.wikipedia.org/wiki/Inode&#34;&gt;inode&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;st_mode&lt;/strong&gt; -Obsahuje práva k souboru&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;st_nlink&lt;/strong&gt; - Počet &lt;a href=&#34;%22http://cs.wikipedia.org/wiki/Pevn%C3%BD_odkaz&#34;&gt;pevných odkazů&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;st_uid&lt;/strong&gt; - ID vlastníka&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;st_gid&lt;/strong&gt; - ID skupiny ve, které je vlastník&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;st_size&lt;/strong&gt; - Celková velikost v bytech&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;st_atime&lt;/strong&gt; - Čas posledního přístupu k souboru&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;st_mtime&lt;/strong&gt; - Čas poslední změny&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;st_ctime&lt;/strong&gt; - Poslední změna statusu (= změna čísla inode)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pro další využití bude nejdůležitější obsah &lt;code&gt;st_mode&lt;/code&gt;. Pro testování jeho obsahu jsou zavedeny mimo jiné &lt;a href=&#34;http://pubs.opengroup.org/onlinepubs/7908799/xsh/sysstat.h.html&#34;&gt;mimo jiné&lt;/a&gt; tyto masky:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;S_IFREG&lt;/strong&gt; - Jde o soubor&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;S_IFLNK&lt;/strong&gt; - Jde o symbolický odkaz&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;S_IFDIR&lt;/strong&gt; - Jde o adresář&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;S_IRUSR&lt;/strong&gt; - Práva pro čtení vlastníkem&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;S_IWUSR&lt;/strong&gt; - Práva pro zápis vlastníkem&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;S_IXUSR&lt;/strong&gt; - Práva pro spuštění vlastníkem&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Krom masek existuje ještě několik maker. Jako jediný parametr &lt;code&gt;m&lt;/code&gt; se jim předává &lt;code&gt;st_mode&lt;/code&gt;. Návratovou hodnotou maker je buď 0, v případě že test neuspěl nebo nenulová hodnota pokud test uspěl.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;S_ISDIR(m)&lt;/strong&gt; - Jde o adresář&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;S_ISFIFO(m)&lt;/strong&gt; - Jde o &lt;a href=&#34;http://cs.wikipedia.org/wiki/Roura_(Unix)&#34;&gt;rouru&lt;/a&gt; nebo speciální soubor &lt;a href=&#34;%22https://cs.wikipedia.org/wiki/Metoda_FIFO&#34;&gt;FIFO&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;S_ISREG(m)&lt;/strong&gt; - Jde o soubor&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;S_ISLNK(m)&lt;/strong&gt; - Jde o symbolický adresář&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Konečně je čas na ukázku použití funkce &lt;code&gt;stat&lt;/code&gt; v akci:&lt;/p&gt;
&lt;!-- raw HTML omitted --&gt;
</content>
    </item>
    
  </channel>
</rss>
